!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Basis=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var _interopRequireWildcard=function(obj){return obj&&obj.__esModule?obj:{"default":obj}};var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj};var BasisObject=_interopRequire(require("./object"));var util=_interopRequireWildcard(require("./util"));var iframe;var BasisArray=function(){if(typeof exports!=="undefined"){return require("vm").runInNewContext("Array")}else{iframe=document.createElement("iframe");iframe.style.display="none";document.body.appendChild(iframe);frames[frames.length-1].document.write("<script>parent._Array = Array;</script>");var _Array=window._Array;delete window._Array;document.body.removeChild(iframe);return _Array}}();var _BasisArray$prototype=BasisArray.prototype;var concat=_BasisArray$prototype.concat;var slice=_BasisArray$prototype.slice;var splice=_BasisArray$prototype.splice;var map=_BasisArray$prototype.map;var filter=_BasisArray$prototype.filter;Object.assign(BasisArray,BasisObject);Object.assign(BasisArray.prototype,BasisObject.prototype);["findIndex","find"].forEach(function(x){BasisArray.prototype[x]=Array.prototype[x]});BasisArray.of=function(){var a=new BasisArray(arguments.length),i,n;BasisObject.call(a);for(i=0,n=arguments.length;i<n;i++){a[i]=arguments[i]}return a};BasisArray.from=function(a){return BasisArray.of.apply(null,a)};(function(){this.displayName="Basis.Array";this.prop("size",{get:function get(){return this.length}});this.prop("first",{get:function get(){return this[0]}});this.prop("@",{get:function get(){return this}});this.prototype.at=function(i,v){var length=this.length;if(i<0){i=length+i}if(arguments.length===1){return i>=0&&i<length?this[i]:undefined}else{this.splice(i,1,v);return v}};this.prototype.eq=function(other){return util.eq(this,other)};this.prototype._splice=function(i,n,added){var removed=splice.apply(this,[i,n].concat(added));if(n!==added.length){this.didChange("size")}if(i===0){this.didChange("first")}this.didChange("@");if(this.__proxy__){removed.forEach(function(x){if(x instanceof BasisObject||x instanceof BasisArray){x._deregisterProxy(this.__proxy__.to,this.__proxy__.name)}},this);added.forEach(function(x){if(x instanceof BasisObject||x instanceof BasisArray){x._registerProxy(this.__proxy__.to,this.__proxy__.name)}},this);this.__proxy__.to.didChange(this.__proxy__.name)}return removed instanceof BasisArray?removed:BasisArray.from(removed)};this.prototype.splice=function(i,n){var added=slice.call(arguments,2),index=i<0?this.length+i:i,removed,j,m;if(index<0){throw new Error("Basis.Array#splice: index "+i+" is too small for "+this)}if(n===undefined){n=this.length-index}return this._splice(index,n,added)};this.prototype.push=function(){var args=slice.call(arguments);this.splice.apply(this,[this.length,0].concat(args));return this.length};this.prototype.unshift=function(){var args=slice.call(arguments);this.splice.apply(this,[0,0].concat(args));return this.length};this.prototype.pop=function(){return this.length>0?this.splice(-1,1).at(0):undefined};this.prototype.shift=function(){return this.length>0?this.splice(0,1).at(0):undefined};this.prototype.slice=function(){var a=slice.apply(this,arguments);return a instanceof BasisArray?a:BasisArray.from(a)};this.prototype.map=function(){var a=map.apply(this,arguments);return a instanceof BasisArray?a:BasisArray.from(a)};this.prototype.filter=function(){var a=filter.apply(this,arguments);return a instanceof BasisArray?a:BasisArray.from(a)};this.prototype.concat=function(){var a=concat.apply(this,arguments);return a instanceof BasisArray?a:BasisArray.from(a)};this.prototype.replace=function(a){this.splice.apply(this,[0,this.length].concat(a));return this};this.prototype.clear=function(){this.splice(0,this.length);return this};this.prototype.flatten=function(){var a=BasisArray.of();for(var i=0,n=this.length;i<n;i++){var el=this[i];if(el instanceof BasisArray){a=a.concat(el.flatten())}else if(Array.isArray(el)){a=a.concat(BasisArray.from(el).flatten())}else{a.push(el)}}return a};this.prototype.compact=function(){return this.reduce(function(acc,el){if(el!=null){acc.push(el)}return acc},BasisArray.of())};this.prototype.uniq=function(){var map=new Map;return this.reduce(function(acc,el){if(!map.has(el)){map.set(el,true);acc.push(el)}return acc},BasisArray.of())};this.prototype.proxy=function(to,name){if(this.__proxy__){this.unproxy()}this.__proxy__={to:to,name:name};this.forEach(function(x){if(x instanceof BasisObject||x instanceof BasisArray){x._registerProxy(to,name)}});return this};this.prototype.unproxy=function(){if(this.__proxy__){this.forEach(function(x){if(x instanceof BasisObject||x instanceof BasisArray){x._deregisterProxy(this.__proxy__.to,this.__proxy__.name)}},this);delete this.__proxy__}return this};this.prototype.toString=function(){return"["+this.map(function(x){return String(x)}).join(", ")+"]"}}).call(BasisArray);module.exports=BasisArray},{"./object":6,"./util":9,vm:11}],2:[function(require,module,exports){"use strict";var _interopRequireWildcard=function(obj){return obj&&obj.__esModule?obj:{"default":obj}};var parsers=_interopRequireWildcard(require("./parsers"));var IdentityAttr=exports.IdentityAttr={coerce:function coerce(v){return v},serialize:function serialize(v){return v}};var StringAttr=exports.StringAttr={coerce:function coerce(v){return v!=null?String(v):v},serialize:function serialize(s){return s}};var NumberAttr=exports.NumberAttr={coerce:function coerce(v){if(typeof v==="number"){return v}else if(typeof v==="string"){return parsers.parseNumber(v)}else{return null}},serialize:function serialize(n){return n}};var BooleanAttr=exports.BooleanAttr={coerce:function coerce(v){return!!v},serialize:function serialize(b){return b}};var DateAttr=exports.DateAttr={coerce:function coerce(v){if(v==null||v instanceof Date){return v}if(typeof v==="number"){return new Date(v)}if(typeof v!=="string"){throw new Error("Basis.DateAttr#coerce: don't know how to coerce `"+v+"` to a Date")}return parsers.parseDate(v)},serialize:function serialize(date){return date instanceof Date?date.toJSON().replace(/T.*$/,""):date}};var DateTimeAttr=exports.DateTimeAttr={coerce:function coerce(v){if(v==null||v instanceof Date){return v}if(typeof v==="number"){return new Date(v)}if(typeof v!=="string"){throw new Error("Basis.DateTimeAttr#coerce: don't know how to coerce `"+v+"` to a Date")}return parsers.parseDateTime(v)},serialize:function serialize(date){return date instanceof Date?date.toJSON():date}};Object.defineProperty(exports,"__esModule",{value:true})},{"./parsers":7}],3:[function(require,module,exports){"use strict";var IdMap={models:new Map,insert:function insert(model){var klass=model.constructor,id=model.id,map;if(!(map=this.models.get(klass))){this.models.set(klass,map=new Map)}if(map.get(id)){throw new Error("IdMap.insert: model of type `"+klass+"` and id `"+id+"` has already been inserted")}map.set(id,model);return this},get:function get(klass,id){var map=this.models.get(klass);return map&&map.get(id)},"delete":function _delete(model){var map=this.models.get(model.constructor);if(!map){return this}map["delete"](model.id);return this},clear:function clear(){this.models.clear();return this}};module.exports=IdMap},{}],4:[function(require,module,exports){"use strict";var _interopRequireWildcard=function(obj){return obj&&obj.__esModule?obj:{"default":obj}};var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj};var BasisObject=_interopRequire(require("./object"));var BasisArray=_interopRequire(require("./array"));var Model=_interopRequire(require("./model"));var ReactMixin=_interopRequire(require("./react_mixin"));var util=_interopRequireWildcard(require("./util"));var parsers=_interopRequireWildcard(require("./parsers"));var pluralize=_interopRequire(require("pluralize"));module.exports=Object.assign({Object:BasisObject,Array:BasisArray,A:BasisArray.of,Model:Model,ReactMixin:ReactMixin,pluralize:pluralize},util,parsers)},{"./array":1,"./model":5,"./object":6,"./parsers":7,"./react_mixin":8,"./util":9,pluralize:13}],5:[function(require,module,exports){"use strict";var _interopRequireWildcard=function(obj){return obj&&obj.__esModule?obj:{"default":obj}};var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj};var pluralize=_interopRequire(require("pluralize"));var IdMap=_interopRequire(require("./id_map"));var BasisObject=_interopRequire(require("./object"));var BasisArray=_interopRequire(require("./array"));var Validations=_interopRequire(require("./validations"));var attrs=_interopRequireWildcard(require("./attrs"));var util=_interopRequireWildcard(require("./util"));var registeredAttrs={},subclasses={};var NEW="new";var EMPTY="empty";var LOADED="loaded";var DELETED="deleted";function resolve(name){var raise=arguments[1]===undefined?true:arguments[1];var klass=typeof name==="function"?name:subclasses[name];if(!klass&&raise){throw new Error(""+Basis.Model+".resolve: could not resolve subclass: `"+name+"`")}return klass}function checkAssociatedType(desc,o){var klass=resolve(desc.klass);if(o&&!(o instanceof klass)){throw new Error(""+desc.debugName+": expected an object of type `"+desc.klass+"` but received `"+o+"` instead")}}function checkOwnerOpts(desc){var klass,inv;if(desc.owner&&desc.inverse&&(klass=resolve(desc.klass,false))&&klass.prototype.associations&&(inv=klass.prototype.associations[desc.inverse])&&inv.owner){throw new Error(""+this+"."+desc.name+": both sides of the association are marked as owner")}}function hasManySplice(i,n,added){var owner=this.__owner__,desc=this.__desc__,inverse=desc.inverse,name=desc.name,removed,changes,i;added.forEach(function(o){return checkAssociatedType(desc,o)});removed=BasisArray.prototype._splice.call(this,i,n,added);if(inverse&&!this.__handlingInverse__){removed.forEach(function(model){model._inverseRemoved(inverse,owner)},this);added.forEach(function(model){model._inverseAdded(inverse,owner)},this)}if(desc.owner){changes=owner.changes[name]=owner.changes[name]||{added:[],removed:[]};added.forEach(function(m){if((i=changes.removed.indexOf(m))!==-1){changes.removed.splice(i,1)}else if(changes.added.indexOf(m)===-1){changes.added.push(m)}});removed.forEach(function(m){if((i=changes.added.indexOf(m))!==-1){changes.added.splice(i,1)}else if(changes.removed.indexOf(m)===-1){changes.removed.push(m)}});if(!changes.added.length&&!changes.removed.length){owner._clearChange(name)}else{owner._setChange(name,changes)}}return removed}function hasManyInverseAdd(model){this.__handlingInverse__=true;this.push(model);this.__handlingInverse__=false}function hasManyInverseRemove(model){var i=this.indexOf(model);if(i>=0){this.__handlingInverse__=true;this.splice(i,1);this.__handlingInverse__=false}}function hasManyArray(owner,desc){var a=BasisArray.of();a.proxy(owner,desc.name);a.__owner__=owner;a.__desc__=desc;a._splice=hasManySplice;a._inverseAdd=hasManyInverseAdd;a._inverseRemove=hasManyInverseRemove;return a}function hasOneSet(desc,v,sync){var name=desc.name,k="__"+name,prev=this[k],inv=desc.inverse,klass=resolve(desc.klass);checkAssociatedType(desc,v);this[k]=v;if(sync&&inv&&prev){prev._inverseRemoved(inv,this)}if(sync&&inv&&v){v._inverseAdded(inv,this)}if(prev){prev._deregisterProxy(this,name)}if(v){v._registerProxy(this,name)}}function mapperDeleteSuccess(){var _this=this;IdMap["delete"](this);this.isBusy=false;this.sourceState=DELETED;this._clearErrors();for(var name in this.associations){var _ret=function(name){var desc=_this.associations[name];if(!desc.inverse){return"continue"}if(desc.type==="hasOne"){var m=undefined;if(m=_this[name]){m._inverseRemoved(desc.inverse,_this)}}else if(desc.type==="hasMany"){_this[name].slice(0).forEach(function(m){m._inverseRemoved(desc.inverse,_this)})}}(name);if(_ret==="continue")continue}}function capitalize(s){return s.charAt(0).toUpperCase()+s.slice(1)}var Model=BasisObject.extend(function(){this.displayName="Basis.Model";this.extend=function(name,f){if(typeof name!=="string"){throw new Error(""+this+".extend: a name is required")}var subclass=BasisObject.extend.call(this);subclass.displayName=name;subclasses[name]=subclass;if(typeof f==="function"){f.call(subclass)}return subclass};this.empty=function(id){var model=new this({id:id});model.sourceState=EMPTY;return model};this.registerAttr=function(name,converter){if(registeredAttrs[name]){throw new Error(""+this+".registerAttr: an attribute with the name `"+name+"` has already been defined")}registeredAttrs[name]=converter;return this};this.attr=function(name,type){var opts=arguments[2]===undefined?{}:arguments[2];var converter=registeredAttrs[type];if(!converter){throw new Error(""+this+".attr: unknown attribute type: `"+type+"`")}if(typeof converter==="function"){converter=new converter(opts)}this.prop(name,{attr:true,converter:converter,get:function get(){return this["__"+name]},set:function set(v){this["__"+name]=converter.coerce(v);this[""+name+"BeforeCoercion"]=v},"default":"default"in opts?opts["default"]:undefined});return this};this.hasOne=function(name,klass){var opts=arguments[2]===undefined?{}:arguments[2];var desc;if(!this.prototype.hasOwnProperty("associations")){this.prototype.associations=Object.create(this.prototype.associations)}this.prototype.associations[name]=desc=Object.assign({},opts,{type:"hasOne",name:name,klass:klass,debugName:""+this.toString()+"#"+name});checkOwnerOpts.call(this,desc);if(desc.owner){if(!this.prototype.hasOwnProperty("__deps__")){this.prototype.__deps__=Object.create(this.prototype.__deps__)}(this.prototype.__deps__[""+name+".hasErrors"]=this.prototype.__deps__[""+name+".hasErrors"]||[]).push("hasErrors");(this.prototype.__deps__[""+name+".hasChanges"]=this.prototype.__deps__[""+name+".hasChanges"]||[]).push("hasChanges")}this.prop(name,{get:function get(){return this["__"+name]},set:function set(v){hasOneSet.call(this,desc,v,true)}});return this};this.hasMany=function(name,klass){var opts=arguments[2]===undefined?{}:arguments[2];var cap=capitalize(name),k="__"+name,desc;if(!this.prototype.hasOwnProperty("associations")){this.prototype.associations=Object.create(this.prototype.associations)}this.prototype.associations[name]=desc=Object.assign({},opts,{type:"hasMany",name:name,klass:klass,singular:pluralize(name,1),debugName:""+this.toString()+"#"+name});checkOwnerOpts.call(this,desc);if(desc.owner){if(!this.prototype.hasOwnProperty("__deps__")){this.prototype.__deps__=Object.create(this.prototype.__deps__)}(this.prototype.__deps__[""+name+".hasErrors"]=this.prototype.__deps__[""+name+".hasErrors"]||[]).push("hasErrors");(this.prototype.__deps__[""+name+".hasChanges"]=this.prototype.__deps__[""+name+".hasChanges"]||[]).push("hasChanges")}this.prop(name,{get:function get(){if(this[k]){return this[k]}desc.klass=resolve(desc.klass);return this[k]=hasManyArray(this,desc)},set:function set(a){this[k].replace(a)}})};this.validate=function(name,f){if(!this.prototype.hasOwnProperty("validators")){this.prototype.validators=Object.create(this.prototype.validators)}(this.prototype.validators[name]=this.prototype.validators[name]||[]).push(f);return this};this.load=function(attrs){var id=attrs.id,associations=this.prototype.associations,associated={},model;if(!id){throw new Error(""+this+".load: an `id` attribute is required")}attrs=Object.assign({},attrs);model=IdMap.get(this,id)||new this;delete attrs.id;for(var _name in associations){var desc=associations[_name];if(_name in attrs){associated[_name]=attrs[_name];delete attrs[_name]}else if(desc.type==="hasOne"&&""+_name+"Id"in attrs){associated[_name]=attrs[""+_name+"Id"];delete attrs[""+_name+"Id"]}else if(desc.type==="hasOne"&&""+_name+"_id"in attrs){associated[_name]=attrs[""+_name+"_id"];delete attrs[""+_name+"_id"]}else if(desc.type==="hasMany"&&""+desc.singular+"Ids"in attrs){associated[_name]=attrs[""+desc.singular+"Ids"];delete attrs[""+desc.singular+"Ids"]}else if(desc.type==="hasMany"&&""+desc.singular+"_ids"in attrs){associated[_name]=attrs[""+desc.singular+"_ids"];delete attrs[""+desc.singular+"_ids"]}}model.set(attrs);if(model.id===undefined){model.id=id}for(var name in associated){var _ret=function(name){var klass=resolve(associations[name].klass);var data=associated[name];if(!data){return"continue"}if(associations[name].type==="hasOne"){var other=typeof data==="object"?klass.load(data):klass.local(data);model[name]=other}else if(associations[name].type==="hasMany"){(function(){var others=[];data.forEach(function(o){others.push(typeof o==="object"?klass.load(o):klass.local(o))});model[name]=others})()}}(name);if(_ret==="continue")continue}model.sourceState=LOADED;model._clearChanges();model._clearErrors();return model};this.loadAll=function(objects){var _this=this;return objects.map(function(object){return _this.load(object)})};this.buildQuery=function(){var modelClass=this,promise=Promise.resolve(),a=BasisArray.of(),queued;a.props({modelClass:{get:function get(){return modelClass}},isBusy:{"default":false},error:{},meta:{}});a.query=function(){var _this=this;var opts=arguments[0]===undefined?{}:arguments[0];if(this.isBusy){if(!queued){promise=promise.then(function(){_this.query(queued);queued=undefined;return promise})}queued=opts}else{this.isBusy=true;promise=modelClass._callMapper("query",[opts]).then(function(result){try{if(Array.isArray(result)){_this.replace(modelClass.loadAll(result))}else if(result.results){_this.replace(modelClass.loadAll(result.results));_this.meta=result.meta}}catch(e){console.error(e);throw e}_this.isBusy=false;_this.error=undefined},function(e){_this.isBusy=false;_this.error=e;return Promise.reject(e)})}return this};a.then=function(f1,f2){return promise.then(f1,f2)};a["catch"]=function(f){return promise["catch"](f)};return a};this.query=function(){var opts=arguments[0]===undefined?{}:arguments[0];return this.buildQuery().query(opts)};this.local=function(id){return IdMap.get(this,id)||this.empty(id)};this.get=function(id){var _this=this;var opts=arguments[1]===undefined?{}:arguments[1];var model=this.local(id),getOpts=Object.assign({},opts);delete getOpts.refresh;if(model.isEmpty||opts.refresh){model.isBusy=true;model.__promise__=this._callMapper("get",[id,getOpts]).then(function(result){model.isBusy=false;try{_this.load(result)}catch(e){console.error(e);throw e}},function(errors){model.isBusy=false;model._loadErrors(errors);return Promise.reject(errors)})}return model};this.clearIdMap=function(){IdMap.clear();return this};this._callMapper=function(method,args){var promise;if(!this.mapper){throw new Error(""+this+"._callMapper: no mapper defined, assign one to `"+this+".mapper`")}if(typeof this.mapper[method]!=="function"){throw new Error(""+this+"._callMapper: mapper does not implement `"+method+"`")}promise=this.mapper[method].apply(this.mapper,args);if(!promise||typeof promise.then!=="function"){throw new Error(""+this+"._callMapper: mapper's `"+method+"` method did not return a Promise")}return promise};this.prototype.associations={};this.prototype.validators={};this.prototype.init=function(props){this.sourceState=NEW;this.isBusy=false;this.__promise__=Promise.resolve();this._clearChanges();Model.__super__.init.call(this,props)};this.prop("id",{get:function get(){return this.__id},set:function set(id){if(this.__id){throw new Error(""+this.constructor+"#id=: overwriting a model's identity is not allowed: "+this)}this.__id=id;IdMap.insert(this)}});this.prop("sourceState");this.prop("isNew",{on:["sourceState"],get:function get(){return this.sourceState===NEW}});this.prop("isEmpty",{on:["sourceState"],get:function get(){return this.sourceState===EMPTY}});this.prop("isLoaded",{on:["sourceState"],get:function get(){return this.sourceState===LOADED}});this.prop("isDeleted",{on:["sourceState"],get:function get(){return this.sourceState===DELETED}});this.prop("isBusy");this.prop("changes",{get:function get(){return this.__changes=this.__changes||{}}});this.prop("hasOwnChanges",{on:["changes"],get:function get(){return Object.keys(this.changes).length>0}});this.prop("hasChanges",{on:["changes"],get:function get(){if(this.hasOwnChanges){return true}for(var _name in this.associations){if(!this.associations[_name].owner){continue}if(this.associations[_name].type==="hasOne"){if(this[_name]&&this[_name].hasChanges){return true}}else if(this.associations[_name].type==="hasMany"){if(this[_name].some(function(m){return m.hasChanges})){return true}}}return false}});this.prop("errors",{get:function get(){return this.__errors=this.__errors||{}}});this.prop("hasOwnErrors",{on:["errors"],get:function get(){return Object.keys(this.errors).length>0}});this.prop("hasErrors",{on:["errors"],get:function get(){if(this.hasOwnErrors){return true}for(var _name in this.associations){if(!this.associations[_name].owner){continue}if(this.associations[_name].type==="hasOne"){if(this[_name]&&this[_name].hasErrors){return true}}else if(this.associations[_name].type==="hasMany"){if(this[_name].some(function(m){return m.hasErrors})){return true}}}return false}});this.prototype.attrs=function(){var attrs={};for(var k in this.__props__){if(this.__props__[k].attr){attrs[k]=this.__props__[k].converter.serialize(this[k])}}if(typeof this.id!=="undefined"){attrs.id=this.id}return attrs};this.prototype.get=function(){var opts=arguments[0]===undefined?{}:arguments[0];if(!this.isLoaded&&!this.isEmpty||this.isBusy){throw new Error(""+this.constructor+"#get: can't get a model in the "+this.stateString()+" state: "+this)}return this.constructor.get(this.id,Object.assign({},opts,{refresh:true}))};this.prototype.save=function(){var _this=this;var opts=arguments[0]===undefined?{}:arguments[0];if(!this.isNew&&!this.isLoaded||this.isBusy){throw new Error(""+this.constructor+"#save: can't save a model in the "+this.stateString()+" state: "+this)}this.isBusy=true;this.__promise__=this.constructor._callMapper(this.isNew?"create":"update",[this,opts]).then(function(attrs){_this.isBusy=false;try{_this.load(attrs)}catch(e){console.error(e);throw e}},function(errors){_this.isBusy=false;_this._loadErrors(errors);return Promise.reject(errors)});return this};this.prototype["delete"]=function(){var _this=this;var opts=arguments[0]===undefined?{}:arguments[0];if(this.isDeleted){return this}if(this.isBusy){throw new Error(""+this.constructor+"#delete: can't delete a model in the "+this.stateString()+" state: "+this)}if(this.isNew){mapperDeleteSuccess.call(this)}else{this.isBusy=true;this.__promise__=this.constructor._callMapper("delete",[this,opts]).then(function(){mapperDeleteSuccess.call(_this)},function(errors){_this.isBusy=false;_this._loadErrors(errors);return Promise.reject(errors)})}return this};this.prototype.then=function(onFulfilled,onRejected){return this.__promise__.then(onFulfilled,onRejected)};this.prototype["catch"]=function(onRejected){return this.__promise__["catch"](onRejected)};this.prototype.load=function(attrs){var id=attrs.id;if(id==null&&this.id==null){throw new Error(""+this.constructor+"#load: an `id` attribute is required")}if(id!=null&&this.id!=null&&id!==this.id){throw new Error(""+this.constructor+"#load: received attributes with id `"+id+"` but model already has id `"+this.id+"`")}if(this.id==null){this.id=id}attrs.id=this.id;this.constructor.load(attrs);return this};this.prototype.stateString=function(){var a=[this.sourceState.toUpperCase()];if(this.isBusy){a.push("BUSY")}return a.join("-")};this.prototype.undoChanges=function(){var _this=this;var associations=this.associations;for(var prop in this.changes){(function(prop){if(associations[prop]&&associations[prop].type==="hasMany"){var removed=_this.changes[prop].removed.slice();var added=_this.changes[prop].added.slice();removed.reverse().forEach(function(m){_this[prop].push(m)});added.forEach(function(m){_this[prop].splice(_this[prop].indexOf(m),1)})}else{_this[prop]=_this.changes[prop]}})(prop)}for(var _name in associations){var desc=associations[_name];if(!desc.owner){continue}if(desc.type==="hasOne"){this[_name]&&this[_name].undoChanges()}else if(desc.type==="hasMany"){this[_name].forEach(function(m){return m.undoChanges()})}}};this.prototype.addError=function(name,message){this.errors[name]=this.errors[name]||[];if(this.errors[name].indexOf(message)===-1){this.errors[name].push(message);this.didChange("errors")}return this};this.prototype.validateAttr=function(name){this._clearErrors(name);if(!this.validators[name]){return true}for(var i=0,n=this.validators[name].length;i<n;i++){var validator=this.validators[name][i];if(typeof validator==="function"){validator.call(this)}else if(typeof validator==="string"&&validator in this){this[validator]()}else{throw new Error(""+this.constructor+"#validateAttr: don't know how to execute validator: `"+validator+"`")}}return!(name in this.errors)};this.prototype.validate=function(){var associations=this.associations;this._clearErrors();for(var _name in this.validators){this.validateAttr(_name)}for(var _name2 in associations){var desc=associations[_name2];if(!desc.owner){continue}if(desc.type==="hasOne"){this[_name2]&&this[_name2].validate()}else if(desc.type==="hasMany"){this[_name2].forEach(function(m){return m.validate()})}}return!this.hasErrors};this.prototype.toString=function(){var attrs=this.attrs();for(var _name in this.associations){if(this.associations[_name].type==="hasOne"){if(this[_name]&&this[_name].id){attrs[_name]=this[_name].id}}else if(this.associations[_name].type==="hasMany"){var ids=this[_name].map(function(x){return x.id}).compact();if(ids.length){attrs[_name]=ids}}}return"#<"+this.constructor+" ("+this.stateString()+"):"+this.objectId+" "+JSON.stringify(attrs)+">"};this.prototype._loadErrors=function(errors){var _this=this;if(typeof errors==="object"){for(var k in errors){(function(k){if(Array.isArray(errors[k])){errors[k].forEach(function(error){this.addError(k,error)},_this)}else{_this.addError(k,String(errors[k]))}})(k)}}else{this.addError("base",String(errors))}return this};this.prototype._clearErrors=function(name){if(name){delete this.errors[name]}else{this.__errors={}}this.didChange("errors");return this};this.prototype._inverseRemoved=function(name,model){var desc=this.associations[name];if(!desc){throw new Error(""+this.constructor+"#inverseRemoved: unknown association `"+name+"`")}if(desc.type==="hasOne"){hasOneSet.call(this,desc,undefined,false)}else if(desc.type==="hasMany"){this[desc.name]._inverseRemove(model)}};this.prototype._inverseAdded=function(name,model){var desc=this.associations[name];if(!desc){throw new Error(""+this.constructor+"#inverseAdded: unknown association `"+name+"`")}if(desc.type==="hasOne"){hasOneSet.call(this,desc,model,false)}else if(desc.type==="hasMany"){this[desc.name]._inverseAdd(model)}};this.prototype._setProp=function(name,value){var oldValue=Model.__super__._setProp.call(this,name,value);if(this.associations&&this.associations[name]&&!this.associations[name].owner){return}if(!(name in this.changes)){if(!util.eq(this[name],oldValue)){this._setChange(name,oldValue)}}else if(util.eq(this[name],this.changes[name])){this._clearChange(name)}};this.prototype._setChange=function(name,oldValue){this.changes[name]=oldValue;this.didChange("changes")};this.prototype._clearChange=function(name){delete this.changes[name];this.didChange("changes")};this.prototype._clearChanges=function(){this.__changes={};this.didChange("changes")}});Model.NEW=NEW;Model.EMPTY=EMPTY;Model.LOADED=LOADED;Model.DELETED=DELETED;Model.registerAttr("identity",attrs.IdentityAttr);Model.registerAttr("string",attrs.StringAttr);Model.registerAttr("number",attrs.NumberAttr);Model.registerAttr("boolean",attrs.BooleanAttr);Model.registerAttr("date",attrs.DateAttr);Model.registerAttr("datetime",attrs.DateTimeAttr);Object.assign(Model,Validations["static"]);Object.assign(Model.prototype,Validations.instance);module.exports=Model},{"./array":1,"./attrs":2,"./id_map":3,"./object":6,"./util":9,"./validations":10,pluralize:13}],6:[function(require,module,exports){"use strict";var objectId=0,changedObjects={},flushTimer;function BasisObject(){Object.defineProperty(this,"objectId",{value:++objectId});this.init.apply(this,arguments)}BasisObject.displayName="Basis.Object";function didChange(object,name){(object.__changedProps__=object.__changedProps__||{})[name]=true;changedObjects[object.objectId]=object;uncache.call(object,name);if(object.__deps__){var deps=object.__deps__[name];if(deps){for(var i=0,n=deps.length;i<n;i++){didChange(object,deps[i])}}}if(object.__proxies__&&name.indexOf(".")===-1){for(var k in object.__proxies__){didChange(object.__proxies__[k].object,""+object.__proxies__[k].name+"."+name)}}}function flush(){var ids=Object.keys(changedObjects);for(var j=0,m=ids.length;j<m;j++){var object=changedObjects[ids[j]];var changes=Object.keys(object.__changedProps__);for(var i=0,n=changes.length;i<n;i++){didChange(object,changes[i])}}for(var id in changedObjects){var object=changedObjects[id];var changes=Object.keys(object.__changedProps__);var star=false;object.__changedProps__={};for(var i=0,n=changes.length;i<n;i++){if(changes[i].indexOf(".")===-1){star=true}object._notify(changes[i])}if(star){object._notify("*")}}changedObjects={};flushTimer=null}function cache(name,value){(this.__cache__=this.__cache__||{})[name]=value}function uncache(name){if(this.__cache__){delete this.__cache__[name]}}function isCached(name){return this.__cache__?this.__cache__.hasOwnProperty(name):false}function getCached(name){return this.__cache__?this.__cache__[name]:undefined}function defineProp(object,name){var opts=arguments[2]===undefined?{}:arguments[2];var descriptor=Object.assign({name:name,get:null,set:null,"default":undefined,on:[],cache:false},opts,{readonly:opts.get&&!opts.set});if(!object.hasOwnProperty("__props__")){object.__props__=Object.create(object.__props__||null)}object.__props__[name]=descriptor;if(!object.hasOwnProperty("__deps__")){object.__deps__=Object.create(object.__deps__||null)}descriptor.on.forEach(function(prop){(object.__deps__[prop]=object.__deps__[prop]||[]).push(name)});Object.defineProperty(object,name,{get:function get(){return this._getProp(name)},set:descriptor.readonly?undefined:function(value){this._setProp(name,value)},configurable:false,enumerable:true})}BasisObject.flush=function(){clearTimeout(flushTimer);flush();return this};BasisObject.extend=function(f){var subclass=function subclass(){BasisObject.apply(this,arguments)};for(var k in this){if(this.hasOwnProperty(k)){subclass[k]=this[k]}}subclass.prototype=Object.create(this.prototype);subclass.prototype.constructor=subclass;subclass.__super__=this.prototype;if(typeof f==="function"){f.call(subclass)}return subclass};BasisObject.prop=function(name){var opts=arguments[1]===undefined?{}:arguments[1];defineProp(this.prototype,name,opts);return this};BasisObject.props=function(props){for(var _name in props){this.prop(_name,props[_name])}return this};BasisObject.toString=function(){return this.displayName||this.name||"(Unknown)"};BasisObject.prototype.init=function(props){if(props){this.set(props)}};BasisObject.prototype.prop=function(name){var opts=arguments[1]===undefined?{}:arguments[1];defineProp(this,name,opts);return this};BasisObject.prototype.props=BasisObject.props;BasisObject.prototype.set=function(props){for(var k in props){if(this.__props__&&this.__props__[k]&&!this.__props__[k].readonly){this[k]=props[k]
}}};BasisObject.prototype.on=function(prop,callback){this.__observers__=this.__observers__||{};this.__observers__[prop]=this.__observers__[prop]||[];this.__observers__[prop].push(callback);return this};BasisObject.prototype.off=function(prop,callback){if(this.__observers__&&this.__observers__[prop]){for(var i=this.__observers__[prop].length-1;i>=0;i--){if(this.__observers__[prop][i]===callback){this.__observers__[prop].splice(i,1)}}}return this};BasisObject.prototype.didChange=function(name){(this.__changedProps__=this.__changedProps__||{})[name]=true;changedObjects[this.objectId]=this;if(!flushTimer){flushTimer=setTimeout(flush)}return this};BasisObject.prototype.toString=function(){return"#<"+this.constructor+":"+this.objectId+">"};BasisObject.prototype.eq=function(other){return this===other};BasisObject.prototype._getProp=function(name){var descriptor=this.__props__&&this.__props__[name],key="__"+name,value;if(!descriptor){throw new Error("Basis.Object#_getProp: unknown prop name `"+name+"`")}if(descriptor.cache&&isCached.call(this,name)){return getCached.call(this,name)}value=descriptor.get?descriptor.get.call(this):this[key];value=value===undefined?descriptor["default"]:value;if(descriptor.cache){cache.call(this,name,value)}return value};BasisObject.prototype._setProp=function(name,value){var descriptor=this.__props__&&this.__props__[name],key="__"+name,old=this._getProp(name);if(!descriptor){throw new Error("Basis.Object#_setProp: unknown prop name `"+name+"`")}if(descriptor.readonly){throw new TypeError("Basis.Object#_setProp: cannot set readonly property `"+name+"` of "+this)}if(descriptor.set){descriptor.set.call(this,value)}else{this[key]=value}this.didChange(name);return old};BasisObject.prototype._notify=function(prop){if(this.__observers__&&this.__observers__[prop]){for(var i=0,n=this.__observers__[prop].length;i<n;i++){this.__observers__[prop][i](prop)}}return this};BasisObject.prototype._registerProxy=function(object,name){this.__proxies__=this.__proxies__||{};this.__proxies__[""+object.objectId+","+name]={object:object,name:name};return this};BasisObject.prototype._deregisterProxy=function(object,name){if(this.__proxies__){delete this.__proxies__[""+object.objectId+","+name]}return this};BasisObject.displayName="Basis.Object";module.exports=BasisObject},{}],7:[function(require,module,exports){"use strict";exports.parseNumber=parseNumber;exports.parsePercent=parsePercent;exports.parseDate=parseDate;exports.parseDateTime=parseDateTime;exports.parseEmail=parseEmail;exports.parsePhone=parsePhone;exports.parseDuration=parseDuration;var NUMBER_RE=/^[-]?([0-9]*[0-9][0-9]*(\.[0-9]+)?|[0]*\.[0-9]*[0-9][0-9]*)$/;function parseNumber(s){s=String(s).replace(/[^\d-.]/g,"").replace(/\.$/,"");if(!s.match(NUMBER_RE)){return null}return parseFloat(s,10)}var MDY_DATE_RE=/^\s*(\d{1,2})[\/-](\d{1,2})(?:[\/-](\d{2,4}))?\s*$/;var ISO8601_DATE_RE=/^(\d\d\d\d)-(\d\d)-(\d\d)$/;function parsePercent(s){var n=parseNumber(String(s).replace("%",""));return n==null?null:n/100}function parseDate(s){var m,d,y,date,parts;s=String(s).replace(/\s/g,"");if(parts=s.match(ISO8601_DATE_RE)){y=parseInt(parts[1],10);m=parseInt(parts[2],10)-1;d=parseInt(parts[3],10);date=new Date(y,m,d);return date.getMonth()===m?date:null}else if(parts=s.match(MDY_DATE_RE)){m=parseInt(parts[1],10)-1;d=parseInt(parts[2],10);y=parts[3]?parseInt(parts[3],10):(new Date).getFullYear();if(0<=y&&y<=68){y+=2e3}if(69<=y&&y<=99){y+=1900}date=new Date(y,m,d);return date.getMonth()===m?date:null}else{return null}}var NO_TZ_RE=/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?$/;function parseDateTime(s){var n;s=String(s);if(s.match(NO_TZ_RE)){s+="Z"}return(n=Date.parse(s))?new Date(n):null}var EMAIL_FORMAT=/^([^@\s]+)@([-a-z0-9]+\.+[a-z]{2,})$/i;function parseEmail(s){s=String(s);return EMAIL_FORMAT.test(s)?s:null}var PHONE_FORMAT=/^\d{10}$/;var PHONE_CHARS=/[\(\)\s-]/g;function parsePhone(s){s=String(s);return PHONE_FORMAT.test(s.replace(PHONE_CHARS,""))?s:null}var DURATION_RE=/^\s*(?:(?::?\d+)|(?::?\d+:\d+)|(?:\d+:\d+:\d+))\s*$/;function parseDuration(s){s=String(s);if(!DURATION_RE.test(s)){return null}var parts=s.split(":").map(function(p){return+p});if(parts.length===3){return parts[0]*3600+parts[1]*60+parts[2]}else if(parts.length===2){return parts[0]*60+parts[1]}else{return parts[0]}}Object.defineProperty(exports,"__esModule",{value:true})},{}],8:[function(require,module,exports){"use strict";module.exports={componentWillMount:function componentWillMount(){var _this=this;if(!this.displayProps){return}this._forceUpdate=function(){this.forceUpdate()}.bind(this);for(var k in this.displayProps){(function(k){_this.displayProps[k].forEach(function(prop){if(this.props[k]){this.props[k].on(prop,this._forceUpdate)}},_this)})(k)}},componentWillUnmount:function componentWillUnmount(){var _this=this;if(!this.displayProps){return}for(var k in this.displayProps){(function(k){_this.displayProps[k].forEach(function(prop){if(this.props[k]){this.props[k].off(prop,this._forceUpdate)}},_this)})(k)}delete this._forceUpdate},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var _this=this;if(!this.displayProps){return}for(var k in this.displayProps){(function(k){_this.displayProps[k].forEach(function(prop){if(nextProps[k]!==this.props[k]){if(this.props[k]){this.props[k].off(prop,this._forceUpdate)}if(nextProps[k]){nextProps[k].on(prop,this._forceUpdate)}}},_this)})(k)}}}},{}],9:[function(require,module,exports){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj};exports.detectRecursion=detectRecursion;exports.type=type;exports.eq=eq;exports.camelize=camelize;exports.underscore=underscore;exports.capitalize=capitalize;var BasisObject=_interopRequire(require("./object"));var toString=Object.prototype.toString,slice=Array.prototype.slice;var seenObjects=[];function seen(o1,o2){var i,len;for(i=0,len=seenObjects.length;i<len;i++){if(seenObjects[i][0]===o1&&seenObjects[i][1]===o2){return true}}return false}function mark(o1,o2){seenObjects.push([o1,o2])}function unmark(o1,o2){var i,n;for(i=0,n=seenObjects.length;i<n;i++){if(seenObjects[i][0]===o1&&seenObjects[i][1]===o2){seenObjects.splice(i,1);return}}}function detectRecursion(o1,o2,f){if(arguments.length===2){f=o2;o2=undefined}if(seen(o1,o2)){return true}else{mark(o1,o2);try{f()}finally{unmark(o1,o2)}return false}}function type(o){if(o===null){return"null"}if(o===undefined){return"undefined"}switch(toString.call(o)){case"[object Array]":return"array";case"[object Arguments]":return"arguments";case"[object Function]":return"function";case"[object String]":return"string";case"[object Number]":return"number";case"[object Boolean]":return"boolean";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Object]":if(o.hasOwnProperty("callee")){return"arguments"}else{return"object"}}return"unknown"}function eq(a,b){var atype,btype,akeys,bkeys,r;if(a===b){return true}if(a instanceof BasisObject){return a.eq(b)}atype=type(a);btype=type(b);if(atype!==btype){return false}switch(atype){case"boolean":case"string":case"date":case"number":return a.valueOf()===b.valueOf();case"regexp":return a.source===b.source&&a.global===b.global&&a.multiline===b.multiline&&a.ignoreCase===b.ignoreCase;case"array":if(a.length!==b.length){return false}r=true;detectRecursion(a,b,function(){var i,len;for(i=0,len=a.length;i<len;i++){if(!eq(a[i],b[i])){r=false;break}}});return r;case"object":akeys=Object.keys(a);bkeys=Object.keys(b);if(akeys.length!==bkeys.length){return false}r=true;detectRecursion(a,b,function(){var i,len,key;for(i=0,len=akeys.length;i<len;i++){key=akeys[i];if(!b.hasOwnProperty(key)){r=false;break}if(!eq(a[key],b[key])){r=false;break}}});return r;default:return false}}function camelize(s){return s.replace(/(?:[-_])(\w)/g,function(_,c){return c?c.toUpperCase():""})}function underscore(s){return s.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()}function capitalize(s){return s[0].toUpperCase()+s.slice(1)}Object.defineProperty(exports,"__esModule",{value:true})},{"./object":6}],10:[function(require,module,exports){"use strict";var _interopRequireWildcard=function(obj){return obj&&obj.__esModule?obj:{"default":obj}};var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj};var BasisArray=_interopRequire(require("./array"));var util=_interopRequireWildcard(require("./util"));var parsers=_interopRequireWildcard(require("./parsers"));function isBlank(v){return v==null||util.type(v)==="string"&&v.match(/^\s*$/)||util.type(v)==="array"&&v.length===0||v instanceof BasisArray&&v.length===0}var Validations={"static":{validatesPresence:function validatesPresence(){var names=Array.from(arguments),opts=util.type(names[names.length-1])==="object"?names.pop():{};names.forEach(function(name){this.validate(name,function(){this.validatePresence(name,opts)})},this);return this},validatesNumber:function validatesNumber(){var names=Array.from(arguments),opts=util.type(names[names.length-1])==="object"?names.pop():{};names.forEach(function(name){this.validate(name,function(){this.validateNumber(name,opts)})},this);return this},validatesDate:function validatesDate(){Array.from(arguments).forEach(function(name){this.validate(name,function(){this.validateDate(name)})},this)},validatesEmail:function validatesEmail(){Array.from(arguments).forEach(function(name){this.validate(name,function(){this.validateEmail(name)})},this);return this},validatesPhone:function validatesPhone(){Array.from(arguments).forEach(function(name){this.validate(name,function(){this.validatePhone(name)})},this);return this},validatesDuration:function validatesDuration(){Array.from(arguments).forEach(function(name){this.validate(name,function(){this.validateDuration(name)})},this);return this}},instance:{validatePresence:function validatePresence(name){var opts=arguments[1]===undefined?{}:arguments[1];if(opts["if"]&&!opts["if"].call(this)){return}var v=this[""+name+"BeforeCoercion"]!=null?this[""+name+"BeforeCoercion"]:this[name];if(isBlank(v)){this.addError(name,"must be present")}},validateNumber:function validateNumber(name){var opts=arguments[1]===undefined?{}:arguments[1];if(util.type(this[name])==="number"){if(opts.nonnegative&&this[name]<0){this.addError(name,"must not be negative")}}else if(!isBlank(this[""+name+"BeforeCoercion"])){this.addError(name,"is not a number")}},validateDate:function validateDate(name){var v=this[""+name+"BeforeCoercion"];if(!isBlank(v)&&!(v instanceof Date)&&!parsers.parseDate(v)){this.addError(name,"is not a date")}},validateEmail:function validateEmail(name){var v=this[""+name+"BeforeCoercion"];if(!isBlank(v)&&!parsers.parseEmail(v)){this.addError(name,"is not an email")}},validatePhone:function validatePhone(name){var v=this[""+name+"BeforeCoercion"];if(!isBlank(v)&&!parsers.parsePhone(v)){this.addError(name,"is not a phone number")}},validateDuration:function validateDuration(name){var v=this[""+name+"BeforeCoercion"];if(!isBlank(v)&&!parsers.parseDuration(v)){this.addError(name,"is not a duration")}}}};module.exports=Validations},{"./array":1,"./parsers":7,"./util":9}],11:[function(require,module,exports){var indexOf=require("indexof");var Object_keys=function(obj){if(Object.keys)return Object.keys(obj);else{var res=[];for(var key in obj)res.push(key);return res}};var forEach=function(xs,fn){if(xs.forEach)return xs.forEach(fn);else for(var i=0;i<xs.length;i++){fn(xs[i],i,xs)}};var defineProp=function(){try{Object.defineProperty({},"_",{});return function(obj,name,value){Object.defineProperty(obj,name,{writable:true,enumerable:false,configurable:true,value:value})}}catch(e){return function(obj,name,value){obj[name]=value}}}();var globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function NodeScript(code){if(!(this instanceof Script))return new Script(code);this.code=code};Script.prototype.runInContext=function(context){if(!(context instanceof Context)){throw new TypeError("needs a 'context' argument.")}var iframe=document.createElement("iframe");if(!iframe.style)iframe.style={};iframe.style.display="none";document.body.appendChild(iframe);var win=iframe.contentWindow;var wEval=win.eval,wExecScript=win.execScript;if(!wEval&&wExecScript){wExecScript.call(win,"null");wEval=win.eval}forEach(Object_keys(context),function(key){win[key]=context[key]});forEach(globals,function(key){if(context[key]){win[key]=context[key]}});var winKeys=Object_keys(win);var res=wEval.call(win,this.code);forEach(Object_keys(win),function(key){if(key in context||indexOf(winKeys,key)===-1){context[key]=win[key]}});forEach(globals,function(key){if(!(key in context)){defineProp(context,key,win[key])}});document.body.removeChild(iframe);return res};Script.prototype.runInThisContext=function(){return eval(this.code)};Script.prototype.runInNewContext=function(context){var ctx=Script.createContext(context);var res=this.runInContext(ctx);forEach(Object_keys(ctx),function(key){context[key]=ctx[key]});return res};forEach(Object_keys(Script.prototype),function(name){exports[name]=Script[name]=function(code){var s=Script(code);return s[name].apply(s,[].slice.call(arguments,1))}});exports.createScript=function(code){return exports.Script(code)};exports.createContext=Script.createContext=function(context){var copy=new Context;if(typeof context==="object"){forEach(Object_keys(context),function(key){copy[key]=context[key]})}return copy}},{indexof:12}],12:[function(require,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],13:[function(require,module,exports){(function(root,pluralize){if(typeof require==="function"&&typeof exports==="object"&&typeof module==="object"){module.exports=pluralize()}else if(typeof define==="function"&&define.amd){define(function(){return pluralize()})}else{root.pluralize=pluralize()}})(this,function(){var pluralRules=[];var singularRules=[];var uncountables={};var irregularPlurals={};var irregularSingles={};function toTitleCase(str){return str.charAt(0).toUpperCase()+str.substr(1).toLowerCase()}function sanitizeRule(rule){if(typeof rule==="string"){return new RegExp("^"+rule+"$","i")}return rule}function restoreCase(word,token){if(word===word.toUpperCase()){return token.toUpperCase()}if(word[0]===word[0].toUpperCase()){return toTitleCase(token)}return token.toLowerCase()}function interpolate(str,args){return str.replace(/\$(\d{1,2})/g,function(match,index){return args[index]||""})}function sanitizeWord(word,collection){if(!word.length||uncountables.hasOwnProperty(word)){return word}var len=collection.length;while(len--){var rule=collection[len];if(rule[0].test(word)){return word.replace(rule[0],function(match,index,word){var result=interpolate(rule[1],arguments);if(match===""){return restoreCase(word[index-1],result)}return restoreCase(match,result)})}}return word}function replaceWord(replaceMap,keepMap,rules){return function(word){var token=word.toLowerCase();if(keepMap.hasOwnProperty(token)){return restoreCase(word,token)}if(replaceMap.hasOwnProperty(token)){return restoreCase(word,replaceMap[token])}return sanitizeWord(word,rules)}}function pluralize(word,count,inclusive){var pluralized=count===1?pluralize.singular(word):pluralize.plural(word);return(inclusive?count+" ":"")+pluralized}pluralize.plural=replaceWord(irregularSingles,irregularPlurals,pluralRules);pluralize.singular=replaceWord(irregularPlurals,irregularSingles,singularRules);pluralize.addPluralRule=function(rule,replacement){pluralRules.push([sanitizeRule(rule),replacement])};pluralize.addSingularRule=function(rule,replacement){singularRules.push([sanitizeRule(rule),replacement])};pluralize.addUncountableRule=function(word){if(typeof word==="string"){return uncountables[word.toLowerCase()]=true}pluralize.addPluralRule(word,"$0");pluralize.addSingularRule(word,"$0")};pluralize.addIrregularRule=function(single,plural){plural=plural.toLowerCase();single=single.toLowerCase();irregularSingles[single]=plural;irregularPlurals[plural]=single};[["I","we"],["me","us"],["he","they"],["she","they"],["them","them"],["myself","ourselves"],["yourself","yourselves"],["itself","themselves"],["herself","themselves"],["himself","themselves"],["themself","themselves"],["this","these"],["that","those"],["echo","echoes"],["dingo","dingoes"],["volcano","volcanoes"],["tornado","tornadoes"],["torpedo","torpedoes"],["genus","genera"],["viscus","viscera"],["stigma","stigmata"],["stoma","stomata"],["dogma","dogmata"],["lemma","lemmata"],["schema","schemata"],["anathema","anathemata"],["ox","oxen"],["axe","axes"],["die","dice"],["yes","yeses"],["foot","feet"],["eave","eaves"],["goose","geese"],["tooth","teeth"],["quiz","quizzes"],["human","humans"],["proof","proofs"],["carve","carves"],["valve","valves"],["thief","thieves"],["genie","genies"],["groove","grooves"],["pickaxe","pickaxes"],["whiskey","whiskies"]].forEach(function(rule){return pluralize.addIrregularRule(rule[0],rule[1])});[[/s?$/i,"s"],[/([^aeiou]ese)$/i,"$1"],[/(ax|test)is$/i,"$1es"],[/(alias|[^aou]us|tlas|gas|ris)$/i,"$1es"],[/(e[mn]u)s?$/i,"$1s"],[/([^l]ias|[aeiou]las|[emjzr]as|[iu]am)$/i,"$1"],[/(alumn|syllab|octop|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1i"],[/(alumn|alg|vertebr)(?:a|ae)$/i,"$1ae"],[/(seraph|cherub)(?:im)?$/i,"$1im"],[/(her|at|gr)o$/i,"$1oes"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)(?:a|um)$/i,"$1a"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|\w+hedr)(?:a|on)$/i,"$1a"],[/sis$/i,"ses"],[/(?:(i)fe|(ar|l|ea|eo|oa|hoo)f)$/i,"$1$2ves"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/([^ch][ieo][ln])ey$/i,"$1ies"],[/(x|ch|ss|sh|zz)$/i,"$1es"],[/(matr|cod|mur|sil|vert|ind|append)(?:ix|ex)$/i,"$1ices"],[/(m|l)(?:ice|ouse)$/i,"$1ice"],[/(pe)(?:rson|ople)$/i,"$1ople"],[/(child)(?:ren)?$/i,"$1ren"],[/eaux$/i,"$0"],[/m[ae]n$/i,"men"]].forEach(function(rule){return pluralize.addPluralRule(rule[0],rule[1])});[[/s$/i,""],[/(ss)$/i,"$1"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)(?:sis|ses)$/i,"$1sis"],[/(^analy)(?:sis|ses)$/i,"$1sis"],[/([^aeflor])ves$/i,"$1fe"],[/(hive|tive|dr?ive)s$/i,"$1"],[/(ar|(?:wo|[ae])l|[eo][ao])ves$/i,"$1f"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/(^[pl]|zomb|^(?:neck)?t|[aeo][lt]|cut)ies$/i,"$1ie"],[/([^c][eor]n|smil)ies$/i,"$1ey"],[/(m|l)ice$/i,"$1ouse"],[/(seraph|cherub)im$/i,"$1"],[/(x|ch|ss|sh|zz|tto|go|cho|alias|[^aou]us|tlas|gas|(?:her|at|gr)o|ris)(?:es)?$/i,"$1"],[/(e[mn]u)s?$/i,"$1"],[/(movie|twelve)s$/i,"$1"],[/(cris|test|diagnos)(?:is|es)$/i,"$1is"],[/(alumn|syllab|octop|vir|radi|nucle|fung|cact|stimul|termin|bacill|foc|uter|loc|strat)(?:us|i)$/i,"$1us"],[/(agend|addend|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi|curricul|automat|quor)a$/i,"$1um"],[/(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|\w+hedr)a$/i,"$1on"],[/(alumn|alg|vertebr)ae$/i,"$1a"],[/(cod|mur|sil|vert|ind)ices$/i,"$1ex"],[/(matr|append)ices$/i,"$1ix"],[/(pe)(rson|ople)$/i,"$1rson"],[/(child)ren$/i,"$1"],[/(eau)x?$/i,"$1"],[/men$/i,"man"]].forEach(function(rule){return pluralize.addSingularRule(rule[0],rule[1])});["advice","agenda","bison","bream","buffalo","carp","chassis","cod","cooperation","corps","digestion","debris","diabetes","energy","equipment","elk","excretion","expertise","flounder","gallows","graffiti","headquarters","health","herpes","highjinks","homework","information","jeans","justice","kudos","labour","machinery","mackerel","media","mews","moose","news","pike","plankton","pliers","pollution","premises","rain","rice","salmon","scissors","series","sewage","shambles","shrimp","species","staff","swine","trout","tuna","whiting","wildebeest","wildlife",/pox$/i,/ois$/i,/deer$/i,/fish$/i,/sheep$/i,/measles$/i,/[^aeiou]ese$/i].forEach(pluralize.addUncountableRule);return pluralize})},{}]},{},[4])(4)});